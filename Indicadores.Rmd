---
title: "INDICADORES DE LA ALERTA DE VIOLENCIA DE GÉNERO CONTRA LAS MUJERES DEL ESTADO DE JALISCO 2020-2021"
author: "Indicadores de Fiscalía y FEPD."
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: hpstr
    highlight: github
---


```{r, , include=F, warning=F, echo=F}

library(prettydoc)
library(readxl)
library(dplyr)
library(DT)
library(scales)
library(ggplot2)
library(plotly)
library(tidyverse)
```

```{r, include=FALSE}
indicador_6 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 6")
indicador_7 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 7")
indicador_9 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 9")
indicador_10 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 10")
indicador_11 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 11")
indicador_12 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 12")
indicador_13 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 13")
indicador_16 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 16")

indicador_24 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 24")
indicador_25 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 25")
indicador_26 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 26")
indicador_27 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 27")
indicador_28 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 28")
indicador_30 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 30")
indicador_31 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 31", range = "A1:G434")

indicador_32 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 32")
indicador_33 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 33")
indicador_34 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 34")
indicador_35 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 35")
indicador_36 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 36")
indicador_37 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 37")
indicador_38 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 38")
indicador_39 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 39")
indicador_40 <- read_excel("indicadores_181021.xlsx", sheet = "Ind 40")

```

```{r, include=FALSE}
indicador_6 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_6
```

```{r, include=FALSE}
  
indicador_6 %>%
      group_by(AÑO, MES) %>% 
  summarise(`MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO`=sum(`TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO ATENDIDAS`),
            `ORDENES DE PROTECCIÓN`=sum(`TOTAL DE MUJERES CANALIZADAS PARA OTORGAMIENTO DE ORDENES DE PROTECCIÓN`),
            `MEDIDAS DE PROTECCIÓN`=sum(`TOTAL DE MUJERES CANALIZADAS PARA OTORGAMIENTO DE MEDIDAS DE PROTECCIÓN`),
            `LÍNEA BASE`=scales::percent(sum((`ORDENES DE PROTECCIÓN`+`MEDIDAS DE PROTECCIÓN`)/`MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO`), 0.1)) -> tabla_6

tabla_6 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO",
                      "ORDENES DE PROTECCIÓN",
                      "MEDIDAS DE PROTECCIÓN"))-> t6

t6 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 6",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO` = "#D98CBC",
          `ORDENES DE PROTECCIÓN` = "#C91682",
          `MEDIDAS DE PROTECCIÓN` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))-> gr6


```

### Indicador 6

#### Porcentaje de mujeres víctimas de violencia por razones de género atendidas y canalizadas para otorgamiento de orden de protección y/o medidas de protección.


```{r, include=T, echo=F}
tabla_6 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr6) %>% 
    layout(title = "Indicador 6",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

  
```

### Indicador 7

#### Porcentaje de mujeres víctimas de violencia por razones de género que solicitaron y obtuvieron orden y/o medida de protección.

###### En Mezquitic y Tuxpan hay valor con NA en 2019. Revisar.
```{r, include=FALSE, echo=F}
indicador_7 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_7
  
indicador_7 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO`=sum(`TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO ATENDIDAS`),
            `TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA MEDIDA DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL`=sum(`TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA MEDIDA DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL`),
            `TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA ORDEN DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL`=sum(`TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA ORDEN DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL`),
            `LÍNEA BASE`=scales::percent(sum(`TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA MEDIDA DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL`/`MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO`), 0.1)) -> tabla_7


tabla_7 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO",
                      "TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA MEDIDA DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL",
                      "TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA ORDEN DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL"))-> t7

t7 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 6",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO` = "#D98CBC",
          `TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA MEDIDA DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL` = "#C91682",
          `TOTAL DE MUJERES VÍCTIMAS DE VIOLENCIA DE GÉNERO QUE SOLICITARON UNA ORDEN DE PROTECCIÓN SIN TENER UNA CANALIZACIÓN FORMAL` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr7
  
  
```

```{r, include=T, echo=F}
tabla_7 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr7)%>% 
    layout(title = "Indicador 7",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))


```

## Indicador 9

#### Porcentaje de medidas de protección otorgadas que fueron trabajadas y/o notificadas efectiva y personalmente a la persona agresora en relación al total.

```{r , include=FALSE, echo=F}
indicador_9 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto" ,
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_9
  
indicador_9 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES`=sum(`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES`),
            
            `MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES QUE FUERON TRABAJADAS`=sum(`MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES QUE FUERON TRABAJADAS`),
            
            `MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`=sum(`MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`),
            
            `LÍNEA BASE`=scales::percent(sum(`MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES QUE FUERON TRABAJADAS`+ `MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`)/`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES`, 0.1)) -> tabla_9



tabla_9 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES",
                      "MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES QUE FUERON TRABAJADAS", 
                      "MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA"))-> t9

t9 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 9",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES` = "#D98CBC",
          `MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO VIGENTES QUE FUERON TRABAJADAS` = "#C91682",
          `MEDIDAS DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr9
```

```{r, include=T, echo=F}
tabla_9 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr9)%>% 
    layout(title = "Indicador 9",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 10

#### Porcentaje de órdenes de protección otorgadas que fueron trabajadas y/o notificadas efectiva y personalmente a la persona agresora en relación al total.

```{r , include=FALSE, echo=F, align="center"}
indicador_10 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_10
  
indicador_10 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO`=sum(`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO`),
            
            `ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON TRABAJADAS`=sum(`ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON TRABAJADAS`),
            
            `ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`=sum(`ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`),
            
            `LÍNEA BASE`=scales::percent(sum(`ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON TRABAJADAS`+ `ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA`)/`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO`, 0.1)) -> tabla_10

tabla_10 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO",
                      "ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON TRABAJADAS",
                      "ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA"))-> t10

t10 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 10",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO` = "#D98CBC",
          `ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON TRABAJADAS` = "#C91682",
          `ÓRDENES DE PROTECCIÓN EMITIDAS POR VIOLENCIA POR RAZÓN DE GÉNERO QUE FUERON NOTIFICADAS EFECTIVA Y PERSONALMENTE A LA PERSONA AGRESORA` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr10

```

```{r, include=T, echo=F}
tabla_10 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr10)%>% 
    layout(title = "Indicador 10",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 11

#### Porcentaje de mujeres que han recibido seguimiento después de otorgada su orden y/o medida de protección en relación al total.

```{r , include=FALSE, echo=F}

indicador_11 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_11
  
indicador_11 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`=sum(`MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`),
            
            `MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`=sum(`MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`),
            
            `TOTAL DE MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES`=sum(`TOTAL DE MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES`),
            
            `TOTAL DE MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES`=sum(`TOTAL DE MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES`),
            
            `LÍNEA BASE`=scales::percent(sum((`MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`+ `MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO`)/(`TOTAL DE MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES` +`TOTAL DE MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES`)), 0.1)) -> tabla_11


tabla_11 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO",
                      "MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO",
                      "TOTAL DE MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES",
                      "TOTAL DE MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES"))-> t11

t11 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 11",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO` = "#B58CD9",
          `MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES QUE HAN RECIBIDO SEGUIMIENTO` = "#D98CBC",
          `TOTAL DE MUJERES CON MEDIDAS DE PROTECCIÓN VIGENTES` = "#7E3794",
          `TOTAL DE MUJERES CON ÓRDENES DE PROTECCIÓN VIGENTES` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr11


```

```{r, include=T, echo=F}
tabla_11 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr11)%>% 
    layout(title = "Indicador 11",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 12

#### Porcentaje de Carpetas de Investigación iniciadas contra personas agresoras derivados de incumplimiento de órdenes y/o medidas de protección.

```{r , include=FALSE, echo=F}
indicador_12 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre",
                             "Julio a Septiembre", "Octubre a Diciembre")))->indicador_12
  
indicador_12 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES`=sum(`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES`),
            
            `TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE MEDIDAS DE PROTECCIÓN`=sum(`TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE MEDIDAS DE PROTECCIÓN`),
            
            `TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`=sum(`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`),
            
            `TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE ÓRDENES DE PROTECCIÓN`=sum(`TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE ÓRDENES DE PROTECCIÓN`),
            
            `LÍNEA BASE`=scales::percent(sum((`TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE MEDIDAS DE PROTECCIÓN`+ `TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE ÓRDENES DE PROTECCIÓN`)/(`TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES` +`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`)), 0.1)) -> tabla_12



tabla_12 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES",
                      "TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE MEDIDAS DE PROTECCIÓN",
                      "TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES",
                      "TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE ÓRDENES DE PROTECCIÓN"))-> t12

t12 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 12",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE ÓRDENES DE PROTECCIÓN` = "#B58CD9",
          `TOTAL DE CARPETAS DE INVESTIGACIÓN INICIADAS CONTRA PERSONAS AGRESORAS DERIVADOS DEL INCUMPLIMIENTO DE MEDIDAS DE PROTECCIÓN` = "#D98CBC",
          `TOTAL DE MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES` = "#7E3794",
          `TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 40, vjust = 0.5, hjust=1)) -> gr12

```

```{r, include=T, echo=F}
tabla_12 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr12)%>% 
    layout(title = "Indicador 12",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 13

#### Porcentaje de casos en los que la orden y/o medida de protección resultó ser adecuada y efectiva para la víctima en relación al total.

```{r , include=FALSE, echo=F}


indicador_13 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre")))->indicador_13
  
indicador_13 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES`=sum(`TOTAL MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES`),
            
            `CASOS EN LOS QUE LA MEDIDA DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`=sum(`CASOS EN LOS QUE LA MEDIDA DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`),
            
            `TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`=sum(`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`),
            
            `CASOS EN LOS QUE LA ORDEN DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`=sum(`CASOS EN LOS QUE LA ORDEN DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`),
            
            `LÍNEA BASE`=scales::percent(sum((`CASOS EN LOS QUE LA MEDIDA DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`+ `CASOS EN LOS QUE LA ORDEN DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)`)/(`TOTAL MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES` +`TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES`)), 0.1)) -> tabla_13


tabla_13 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES",
                      "CASOS EN LOS QUE LA MEDIDA DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)",
                      "TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES",
                      "CASOS EN LOS QUE LA ORDEN DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)"))-> t13

t13 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 13",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `CASOS EN LOS QUE LA MEDIDA DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)` = "#B58CD9",
          `CASOS EN LOS QUE LA ORDEN DE PROTECCIÓN NO RESULTÓ SER ADECUADA Y EFECTIVA PARA LA VÍCTIMA (Casos de reincidencia)` = "#D98CBC",
          `TOTAL DE ÓRDENES DE PROTECCIÓN EMITIDAS VIGENTES` = "#7E3794",
          `TOTAL MEDIDAS DE PROTECCIÓN EMITIDAS VIGENTES` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 40, vjust = 0.5, hjust=1)) -> gr13

```

```{r, include=T, echo=F}
tabla_13 %>% datatable(filter="top", options = list(pageLength = 6))
ggplotly(gr13)%>% 
    layout(title = "Indicador 13",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 16

#### Porcentaje de mujeres denunciantes de violación o abuso sexual infantil que son remitidas para atención integral de la salud conforme a la NOM 046 en relación al total.

```{r , include=FALSE, echo=F}
indicador_16 %>%
  mutate(MES=factor(Mes,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre", "Enero a Marzo",
                             "Abril a Junio", "Julio a Septiembre", "Octubre a Diciembre")))->indicador_16
  
indicador_16 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE MUJERES QUE DENUNCIAN ABUSO SEXUAL INFANTIL`=sum(`TOTAL DE MUJERES QUE DENUNCIAN ABUSO SEXUAL INFANTIL`),
            
            `TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR ABUSO SEXUAL INFANTIL`=sum(`TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR ABUSO SEXUAL INFANTIL`),
            
            `TOTAL DE MUJERES QUE DENUNCIAN VIOLACIÓN`=sum(`TOTAL DE MUJERES QUE DENUNCIAN VIOLACIÓN`),
            
            `TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR VIOLACIÓN`=sum(`TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR VIOLACIÓN`),
            
            `LÍNEA BASE`=scales::percent(sum((`TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR ABUSO SEXUAL INFANTIL`+ `TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR VIOLACIÓN`)/(`TOTAL DE MUJERES QUE DENUNCIAN ABUSO SEXUAL INFANTIL` +`TOTAL DE MUJERES QUE DENUNCIAN VIOLACIÓN`)), 0.1)) -> tabla_16

tabla_16 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE MUJERES QUE DENUNCIAN ABUSO SEXUAL INFANTIL",
                      "TOTAL DE MUJERES QUE DENUNCIAN VIOLACIÓN",
                      "TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR ABUSO SEXUAL INFANTIL",
                      "TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR VIOLACIÓN"))-> t16

t16 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 13",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR ABUSO SEXUAL INFANTIL` = "#B58CD9",
          `TOTAL DE MUJERES CANALIZADAS PARA ATENCIÓN INTEGRAL DE LA SALUD (NOM 46) POR VIOLACIÓN` = "#D98CBC",
          `TOTAL DE MUJERES QUE DENUNCIAN ABUSO SEXUAL INFANTIL` = "#7E3794",
          `TOTAL DE MUJERES QUE DENUNCIAN VIOLACIÓN` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 40, vjust = 0.5, hjust=1)) -> gr16


```

```{r, include=T, echo=F}
tabla_16 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr16)%>% 
    layout(title = "Indicador 16",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 24

#### Porcentaje de municipios que actualizan la información sobre atención a mujeres víctimas de violencia con respecto al total.
#### Entre 2020 a abril 2021 indicaban 129 instancias responsables, y después sólo dejan a 125
```{r , include=FALSE, echo=F}
indicador_24 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre"))) %>% 
         mutate(ACTUALIZAN=case_when(
           ACTUALIZAN=="Si"~1,
           ACTUALIZAN=="No"~0)) %>% 
         
         mutate(INSTANCIA=case_when(
           INSTANCIA==NA ~ 0,
           INSTANCIA==NA_character_~ 0,
           T~1))->indicador_24
  
indicador_24 %>% 
      group_by(AÑO, MES) %>% 
  summarise(ACTUALIZAN=sum(ACTUALIZAN),
            
            INSTANCIA=sum(INSTANCIA),
            
            `LÍNEA BASE`=scales::percent(sum(ACTUALIZAN/INSTANCIA), 0.1)) -> tabla_24

tabla_24 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("ACTUALIZAN",
                      "INSTANCIA"))-> t24

t24 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 9",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`ACTUALIZAN` = "#C91682",
          `INSTANCIA` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr24

```

```{r, include=T, echo=F}
datatable(tabla_24, options = list(
    pageLength = 6,
    initComplete = JS(
      "function(settings, json) {",
      "$(this.api().table().header()).css({'background-color': '#C91682', 'color': 'white'});",
      "}")))
  
ggplotly(gr24)%>% 
    layout(title = "Indicador 24",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 25

#### Porcentaje del personal responsable de la actualización del banco de datos adecuadamente capacitado con relación al total.

###### Aquí checar los porcentajes totales, verificar.
###### El primer semestre de 2020 sí nos indican que hay 0 personal capacitado.

```{r , include=FALSE, echo=F}

indicador_25 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre", "Enero a junio", "Julio a Diciembre"))) ->indicador_25
  
indicador_25 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`PERSONAL RESPONSABLE DE LA ACTUALIZACIÓN DE DATOS`=sum(`PERSONAL RESPONSABLE DE LA ACTUALIZACIÓN DE DATOS`),
            
            `PERSONAS DEBIDAMENTE CAPACITADAS DE ALIMENTAR BANAVIM`=sum(`PERSONAS DEBIDAMENTE CAPACITADAS DE ALIMENTAR BANAVIM`),
            
            `LÍNEA BASE`=scales::percent(sum(`PERSONAS DEBIDAMENTE CAPACITADAS DE ALIMENTAR BANAVIM`/`PERSONAL RESPONSABLE DE LA ACTUALIZACIÓN DE DATOS`), 0.1)) -> tabla_25

tabla_25 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("PERSONAL RESPONSABLE DE LA ACTUALIZACIÓN DE DATOS",
                      "PERSONAS DEBIDAMENTE CAPACITADAS DE ALIMENTAR BANAVIM"))-> t25

t25 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 9",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`PERSONAL RESPONSABLE DE LA ACTUALIZACIÓN DE DATOS` = "#C91682",
          `PERSONAS DEBIDAMENTE CAPACITADAS DE ALIMENTAR BANAVIM` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr25
```

```{r, include=T, echo=F}
tabla_25 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr25)%>% 
    layout(title = "Indicador 25",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 26

#### Porcentaje de instancias estatales responsables de alimentar banco de datos que actualizan en tiempo y forma en relación al total de instancias obligadas.

```{r , include=FALSE, echo=F}


indicador_26 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre"))) %>% 
  mutate(ACTUALIZACIÓN=case_when(
           ACTUALIZACIÓN=="Si"~1,
           ACTUALIZACIÓN=="No"~0)) ->indicador_26
  


indicador_26 %>% 
      group_by(AÑO, MES) %>% 
  summarise(ACTUALIZACIÓN=sum(ACTUALIZACIÓN),
           `LÍNEA BASE`=scales::percent(sum(ACTUALIZACIÓN/7), 0.1)) -> tabla_26

tabla_26 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("ACTUALIZACIÓN"))-> t26

t26 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 26",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`ACTUALIZACIÓN` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr26
```

```{r, include=T, echo=F}
tabla_26 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr26)%>% 
    layout(title = "Indicador 26",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))


```

## Indicador 27

#### Número de opiniones técnicas que ha emitido la Dirección de Análisis y Contexto sobre los delitos de feminicidio y desaparición de niñas, adolescentes y mujeres.

```{r , include=FALSE, echo=F}

indicador_27 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_27
  
indicador_27 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`NÚMERO DE CASOS ANALIZADOS`=sum(`NÚMERO DE CASOS ANALIZADOS`),
            `TOTAL OPINIONES TÉCNICAS`=sum(`TOTAL OPINIONES TÉCNICAS`),
           `LÍNEA BASE`=scales::percent(sum(`NÚMERO DE CASOS ANALIZADOS`/`TOTAL OPINIONES TÉCNICAS`), 0.1)) -> tabla_27

tabla_27 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("NÚMERO DE CASOS ANALIZADOS",
                      "TOTAL OPINIONES TÉCNICAS"))-> t27
t27 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 27",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`NÚMERO DE CASOS ANALIZADOS` = "#C91682",
                   `TOTAL OPINIONES TÉCNICAS` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr27


```

```{r, include=T, echo=F}
tabla_27 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr27)%>% 
    layout(title = "Indicador 27",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 28

#### Porcentaje de mujeres víctimas de violación y violencia familiar que son atendidas y proceden a realizar una denuncia en los Centros de Justicia para las Mujeres, en relación al total de mujeres atendidas en los Centros de Justicia para las Mujeres

```{r , include=FALSE, echo=F}

indicador_28 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_28
  
indicador_28 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLACION`=sum(`MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLACION`),
            `MUJERES ATENDIDAS EN EL CJM`=sum(`MUJERES ATENDIDAS EN EL CJM`),
            `MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLENCIA FAMILIAR`=sum(`MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLENCIA FAMILIAR`),
           `LÍNEA BASE`=scales::percent(sum((`MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLACION`+ `MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLENCIA FAMILIAR`)/`MUJERES ATENDIDAS EN EL CJM`), 0.1)) -> tabla_28


tabla_28 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("MUJERES ATENDIDAS EN EL CJM",
                      "MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLACION",
                      "MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLENCIA FAMILIAR"))-> t28

t28 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 28",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `MUJERES ATENDIDAS EN EL CJM` = "#D98CBC",
          `MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLACION` = "#C91682",
          `MUJERES QUE REALIZAN UNA DENUNCIA POR EL DELITO DE VIOLENCIA FAMILIAR` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr28

```

```{r, include=T, echo=F}
tabla_28 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr28)%>% 
    layout(title = "Indicador 28",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 29
#### Pendiente
#### Porcentaje de casos de violencia contra las mujeres por razones de género judicializados.

## Indicador 30

#### Porcentaje de sentencias por el delito de feminicidio en relación a los casos vinculados a proceso.


##### AÑO 2020 [36 en proceso 2020 y 11 sentencias: 31%]
##### AÑO 2020 [29 en proceso 2020 y 06 sentencias: 21%]
```{r , include=FALSE, echo=F}

indicador_30 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre"))) %>% 
   mutate(`AÑO DE SENTENCIA`=case_when(
           `AÑO DE SENTENCIA`==2021~1,
           `AÑO DE SENTENCIA`==2020~1, 
           T~0))->indicador_30

indicador_30 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE SENTENCIA`=sum(`AÑO DE SENTENCIA`),
           `LÍNEA BASE`=scales::percent(sum(`TOTAL DE SENTENCIA`/n()))) -> tabla_30

tabla_30 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE SENTENCIA"))-> t30

t30 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 30",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`TOTAL DE SENTENCIA` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr30


```

```{r, include=T, echo=F}
tabla_30 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr30)%>% 
    layout(title = "Indicador 30",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 31

#### Porcentaje de niñas, adolescentes y mujeres denunciadas como desaparecidas que son localizadas.

#### Pendiente
```{r , include=FALSE, echo=F}

indicador_31 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre",
                             "Enero a Junio", "Julio a Diciembre")))->indicador_31

indicador_31$DESAPARECIDAS<- as.numeric(indicador_31$DESAPARECIDAS)
indicador_31$LOCALIZADAS<- as.numeric(indicador_31$LOCALIZADAS)

indicador_31 %>% 
      group_by(AÑO, MES) %>% 
  summarise(DESAPARECIDAS=sum(DESAPARECIDAS),
            LOCALIZADAS=sum(LOCALIZADAS),
           `LÍNEA BASE`=scales::percent(sum(LOCALIZADAS/DESAPARECIDAS))) -> tabla_31

tabla_31 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("DESAPARECIDAS",
                      "LOCALIZADAS"))-> t31
t31 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 27",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`DESAPARECIDAS` = "#C91682",
                   `LOCALIZADAS` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr31

```

```{r, include=T, echo=F}
tabla_31 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr31)%>% 
    layout(title = "Indicador 31",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 32

#### Número de denuncias de niñas, adolescentes y mujeres desaparecidas.

```{r , include=FALSE, echo=F}

indicador_32 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre"))) ->indicador_32
  
indicador_32 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`TOTAL DE NÚMERO DE DENUNCIAS DE NIÑAS, ADOLESCENTES Y MUJERES DESAPARECIDAS`= sum(
                                                `0 A 2 AÑOS`+
                                                `3 A 5 AÑOS`+
                                                `6 A 12 AÑOS`+
                                                `13 A 17 AÑOS`+
                                                `18 A 25 AÑOS`+
                                                `26 A 35 AÑOS`+
                                                `36 A 45 AÑOS`+
                                                `46 A 59 AÑOS`+
                                                `60  AÑOS EN ADELANTE`+
                                                `SIN DATOS`)) -> tabla_32
tabla_32 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE NÚMERO DE DENUNCIAS DE NIÑAS, ADOLESCENTES Y MUJERES DESAPARECIDAS"))-> t32

t32 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 30",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`TOTAL DE NÚMERO DE DENUNCIAS DE NIÑAS, ADOLESCENTES Y MUJERES DESAPARECIDAS` = "#C91682"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr32

```

```{r, include=T, echo=F}
tabla_32 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr32)%>% 
    layout(title = "Indicador 32",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 33

#### Porcentaje de cédulas únicas de difusión que son remitidas al Comité Técnico de Colaboración.
#### 2021
###### Cuadrar que no en meses como FEB, MAY y JUN hayan estado en cero cédulas.

```{r , include=FALSE, echo=F}

indicador_33 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre")))->indicador_33
  
indicador_33 %>% 
      group_by(AÑO,MES) %>% 
  summarise(`TOTAL DE CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS`=sum(`TOTAL DE CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS`),
            `CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS QUE SON REMITIDAS AL COMITÉ TÉCNICO DE COLABORACIÓN`=sum(`CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS QUE SON REMITIDAS AL COMITÉ TÉCNICO DE COLABORACIÓN`),
           `LÍNEA BASE`=scales::percent(sum((`CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS QUE SON REMITIDAS AL COMITÉ TÉCNICO DE COLABORACIÓN`)/`TOTAL DE CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS`), 0.1)) -> tabla_33
  
tabla_33 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("TOTAL DE CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS",
                      "CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS QUE SON REMITIDAS AL COMITÉ TÉCNICO DE COLABORACIÓN"))-> t33
t33 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 33",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`TOTAL DE CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS` = "#C91682",
                   `CÉDULAS ÚNICAS DE DIFUSIÓN EMITIDAS QUE SON REMITIDAS AL COMITÉ TÉCNICO DE COLABORACIÓN` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr33

```

```{r, include=T, echo=F}
tabla_33 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr33)%>% 
    layout(title = "Indicador 33",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 34

#### Porcentaje de casos de búsqueda y localización realizados de forma inmediata y diferenciada en relación al total de casos.

##### OJO: Estos datos sí coinciden con los indicadores anteriores, pero indica que en cada más a cada caso se le aplicó el protocolo a cabalidad (sólo validar).

```{r , include=FALSE, echo=F}

indicador_34 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_34
  
indicador_34 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`NÚMERO DE CASOS DE LOCALIZACIÓN`=sum(`NÚMERO DE CASOS DE LOCALIZACIÓN`),
            `NÚMERO DE CASOS DE BÚSQUEDA`=sum(`NÚMERO DE CASOS DE BÚSQUEDA`),
            `NÚMERO DE CASOS DE APLICACIÓN A CABALIDAD DEL PROTOCOLO ALBA`=sum(`NÚMERO DE CASOS DE APLICACIÓN A CABALIDAD DEL PROTOCOLO ALBA`),
           `LÍNEA BASE`=scales::percent(sum((`NÚMERO DE CASOS DE LOCALIZACIÓN`)/`NÚMERO DE CASOS DE APLICACIÓN A CABALIDAD DEL PROTOCOLO ALBA`), 0.1)) -> tabla_34

tabla_34 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("NÚMERO DE CASOS DE LOCALIZACIÓN",
                      "NÚMERO DE CASOS DE BÚSQUEDA",
                      "NÚMERO DE CASOS DE APLICACIÓN A CABALIDAD DEL PROTOCOLO ALBA"))-> t34
t34 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 34",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(
          `NÚMERO DE CASOS DE LOCALIZACIÓN` = "#D98CBC",
          `NÚMERO DE CASOS DE BÚSQUEDA` = "#C91682",
          `NÚMERO DE CASOS DE APLICACIÓN A CABALIDAD DEL PROTOCOLO ALBA` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr34
```

```{r, include=T, echo=F}
tabla_34 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr34)%>% 
    layout(title = "Indicador 34",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 35

#### Porcentaje de Cédulas de Difusión activas en relación al total de Cédulas de Difusión emitidas.

###### Mismo caso del 33: Cuadrar que no en meses como FEB, MAY y JUN hayan estado en cero cédulas.

```{r , include=FALSE, echo=F}

indicador_35 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre")))->indicador_35
indicador_35 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`CÉDULAS DE DIFUSIÓN ACTIVAS`=sum(`CÉDULAS DE DIFUSIÓN ACTIVAS`),
            `TOTAL DE CÉDULAS DE DIFUSIÓN EMITIDAS`=sum(`TOTAL DE CÉDULAS DE DIFUSIÓN EMITIDAS`),
           `LÍNEA BASE`=scales::percent(sum((`CÉDULAS DE DIFUSIÓN ACTIVAS`)/`TOTAL DE CÉDULAS DE DIFUSIÓN EMITIDAS`), 0.1)) -> tabla_35

tabla_35 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("CÉDULAS DE DIFUSIÓN ACTIVAS",
                      "TOTAL DE CÉDULAS DE DIFUSIÓN EMITIDAS"))-> t35
t35 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 35",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`CÉDULAS DE DIFUSIÓN ACTIVAS` = "#C91682",
                   `TOTAL DE CÉDULAS DE DIFUSIÓN EMITIDAS` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr35

```

```{r, include=T, echo=F}
tabla_35 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr35)%>% 
    layout(title = "Indicador 35",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 36

#### Porcentaje de casos de investigación de desaparición de niñas y adolescentes en los que se activa reporte Amber.

##### Coinciden los datos con el resto de los indicadores, sólo checar que indican que cada caso se activó Amber

```{r , include=FALSE, echo=F}

indicador_36 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre", "Octubre","Noviembre", "Diciembre")))->indicador_36
  
indicador_36 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`NÚMERO DE CASOS EN LOS QUE SE ACTIVA, DE CONFORMIDAD CON LA NORMATIVIDAD Y EN EL TIEMPO ESTABLECIDO EL PROTOCOLO DE LA ALERTA AMBER`=sum(`NÚMERO DE CASOS EN LOS QUE SE ACTIVA, DE CONFORMIDAD CON LA NORMATIVIDAD Y EN EL TIEMPO ESTABLECIDO EL PROTOCOLO DE LA ALERTA AMBER`),
            `TOTAL DE CASOS DE DESAPARICIÓN DE NIÑAS Y ADOLESCENTES`=sum(`TOTAL DE CASOS DE DESAPARICIÓN DE NIÑAS Y ADOLESCENTES`),
           `LÍNEA BASE`=scales::percent(sum((`NÚMERO DE CASOS EN LOS QUE SE ACTIVA, DE CONFORMIDAD CON LA NORMATIVIDAD Y EN EL TIEMPO ESTABLECIDO EL PROTOCOLO DE LA ALERTA AMBER`)/`TOTAL DE CASOS DE DESAPARICIÓN DE NIÑAS Y ADOLESCENTES`), 0.1)) -> tabla_36 

tabla_36 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("NÚMERO DE CASOS EN LOS QUE SE ACTIVA, DE CONFORMIDAD CON LA NORMATIVIDAD Y EN EL TIEMPO ESTABLECIDO EL PROTOCOLO DE LA ALERTA AMBER",
                      "TOTAL DE CASOS DE DESAPARICIÓN DE NIÑAS Y ADOLESCENTES"))-> t36

t36 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 36",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`NÚMERO DE CASOS EN LOS QUE SE ACTIVA, DE CONFORMIDAD CON LA NORMATIVIDAD Y EN EL TIEMPO ESTABLECIDO EL PROTOCOLO DE LA ALERTA AMBER` = "#C91682",
                   `TOTAL DE CASOS DE DESAPARICIÓN DE NIÑAS Y ADOLESCENTES` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr36
```

```{r, include=T, echo=F}
tabla_36 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr36)%>% 
    layout(title = "Indicador 36",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 37

#### Porcentaje de personal capacitado en el Protocolo Alba.

##### Validar lo de "Función" del personal.

###### OJO: A excepeción de P.I. y Auxiliar jurídico, se indica que el resto está capacitado.

```{r , include=FALSE, echo=F}

indicador_37 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio", "Julio", "Agosto",
                             "Septiembre", "Octubre", "Noviembre", "Diciembre")))->indicador_37
  


indicador_37 %>% 
      group_by(AÑO, MES, PERSONAL) %>% 
  summarise(`PERSONAL DE LA FISCALÍA DEBIDAMENTE FORMADO EN EL FUNCIONAMIENTO DEL PROTOCOLO ALBA`=sum(`PERSONAL DE LA FISCALÍA DEBIDAMENTE FORMADO EN EL FUNCIONAMIENTO DEL PROTOCOLO ALBA`),
            `TOTAL PERSONAL DE LA FISCALÍA`=sum(`TOTAL PERSONAL DE LA FISCALÍA`),
           `LÍNEA BASE`=scales::percent(sum((`PERSONAL DE LA FISCALÍA DEBIDAMENTE FORMADO EN EL FUNCIONAMIENTO DEL PROTOCOLO ALBA`)/`TOTAL PERSONAL DE LA FISCALÍA`), 0.1)) -> tabla_37 
```

```{r, include=T, echo=F}
tabla_37 %>% datatable(filter="top", options = list(pageLength = 6))

```

## Indicador 38

#### Porcentaje de casos resueltos en etapa de investigación.

```{r , include=FALSE, echo=F}

indicador_38 %>%
  mutate(MES=factor(Mes,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_38
  
indicador_38 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`CASOS DE DESAPARICIÓN DENUNCIADOS`=sum(`CASOS DE DESAPARICIÓN DENUNCIADOS`),
            `TOTAL DE CASOS RESUELTOS EN ETAPA DE INVESTIGACIÓN`=sum(`TOTAL DE CASOS RESUELTOS EN ETAPA DE INVESTIGACIÓN`),
           `LÍNEA BASE`=scales::percent(sum((`TOTAL DE CASOS RESUELTOS EN ETAPA DE INVESTIGACIÓN`)/`CASOS DE DESAPARICIÓN DENUNCIADOS`), 0.1)) -> tabla_38

tabla_38 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("CASOS DE DESAPARICIÓN DENUNCIADOS",
                      "TOTAL DE CASOS RESUELTOS EN ETAPA DE INVESTIGACIÓN"))-> t38

t38 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 38",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`CASOS DE DESAPARICIÓN DENUNCIADOS` = "#C91682",
                   `TOTAL DE CASOS RESUELTOS EN ETAPA DE INVESTIGACIÓN` = "#7E3794"))+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr38
```

```{r, include=T, echo=F}
tabla_38 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr38)%>% 
    layout(title = "Indicador 38",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```

## Indicador 39

#### Porcentaje de casos de desaparición que reciben seguimiento.

##### OJO: Aquí este indicador va con 100 en cada mes.

```{r , include=FALSE, echo=F}

indicador_39 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_39
  
indicador_39 %>% 
      group_by(AÑO, MES) %>% 
  summarise(`CASOS DE DESAPARICIÓN QUE RECIBEN SEGUIMIENTO POR PARTE DE PROTOCOLO ALBA`=sum(`CASOS DE DESAPARICIÓN QUE RECIBEN SEGUIMIENTO POR PARTE DE PROTOCOLO ALBA`),
            `TOTAL DE CASOS DE DESAPARICIÓN DENUNCIADOS`=sum(`TOTAL DE CASOS DE DESAPARICIÓN DENUNCIADOS`),
           `LÍNEA BASE`=scales::percent(sum((`CASOS DE DESAPARICIÓN QUE RECIBEN SEGUIMIENTO POR PARTE DE PROTOCOLO ALBA`)/`TOTAL DE CASOS DE DESAPARICIÓN DENUNCIADOS`), 0.1)) -> tabla_39

tabla_39 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("CASOS DE DESAPARICIÓN QUE RECIBEN SEGUIMIENTO POR PARTE DE PROTOCOLO ALBA",
                      "TOTAL DE CASOS DE DESAPARICIÓN DENUNCIADOS"))-> t39

t39 %>% 
 ggplot() +
  aes(x = MES, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 39",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`CASOS DE DESAPARICIÓN QUE RECIBEN SEGUIMIENTO POR PARTE DE PROTOCOLO ALBA` = "#C91682",
                   `TOTAL DE CASOS DE DESAPARICIÓN DENUNCIADOS` = "#7E3794")) +
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) -> gr39
```

```{r, include=T, echo=F}
tabla_39 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr39)%>% 
    layout(title = "Indicador 39",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))

```

## Indicador 40

#### Porcentaje de muertes violentas de mujeres registradas, en relación al año anterior.

##### Falta comparar con el año anterior, sólo estamos en las sumatorias.
##### Corroborar que sean víctimas o carpetas y a su vez cuadrar los totales, hace ruido el total feminicidios.

##### Suma== 362 muertes violentas.

```{r , include=FALSE, echo=F}

indicador_40 %>%
  mutate(MES=factor(MES,
                    levels=c("Enero", "Febrero", "Marzo","Abril", "Mayo", "Junio","Julio", "Agosto",
                             "Septiembre","Octubre", "Noviembre", "Diciembre")))->indicador_40
  
indicador_40 %>% 
      group_by(AÑO) %>% 
  summarise(`HOMICIDIO CULPOSO`=sum(`HOMICIDIO CULPOSO`),
            `HOMICIDIO DOLOSO`=sum(`HOMICIDIO DOLOSO`),
            `ACCIDENTE`=sum(`ACCIDENTE`),
            `FEMINICIDIO`=sum(`FEMINICIDIO`),
            `SUICIDIO`=sum(`SUICIDIO`),
            `EL QUE RESULTE`=sum(`EL QUE RESULTE`),
    `LÍNEA BASE`=sum(`HOMICIDIO CULPOSO`+ `HOMICIDIO DOLOSO`+
                                              `ACCIDENTE`+ `FEMINICIDIO`+
                                              `SUICIDIO`+ `EL QUE RESULTE`)) -> tabla_40

tabla_40 %>% 
  pivot_longer(names_to = "CLASIFICACIÓN",
               values_to = "TOTAL",
               cols=c("HOMICIDIO CULPOSO",
                      "HOMICIDIO DOLOSO",
                      "ACCIDENTE",
                      "FEMINICIDIO",
                      "SUICIDIO",
                      "EL QUE RESULTE"))-> t40

t40 %>% 
 ggplot() +
  aes(x = AÑO, y = TOTAL, colour = CLASIFICACIÓN, group=CLASIFICACIÓN) +
  geom_line(size = 1.5) + geom_point(size = 3)+
  labs(x="", y="", title = "Indicador 39",
       color = "CLASIFICACIÓN") +
  theme_minimal()+   
  #facet_wrap(vars(AÑO))+
  scale_y_continuous(labels = scales::comma) +
  scale_color_manual(
        values = c(`HOMICIDIO CULPOSO` = "#C91682",
                   `HOMICIDIO DOLOSO` = "#7E3794",
                   `ACCIDENTE` = "#D98CBC",
                   `FEMINICIDIO`= "#B58CD9",
                   `SUICIDIO`= "#A544FF",
                   `EL QUE RESULTE`= "#597DFF")) +
  theme(legend.position = "bottom") -> gr40


```

```{r, include=T, echo=F}
tabla_40 %>% datatable(filter="top", options = list(pageLength = 6))

ggplotly(gr40)%>% 
    layout(title = "Indicador 40",
    legend = list(orientation = 'v', 
                  x = 0, y = -1), 
    xaxis = list(side = "bottom"),legend = list(side="bottom"))
```
